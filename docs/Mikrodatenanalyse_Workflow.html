<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Mikrodatenanalyse in R</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">IW-R-Kurs</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Ziele.html">Ziele</a>
</li>
<li>
  <a href="Stunde1.html">1. Stunde</a>
</li>
<li>
  <a href="Mikrodatenanalyse_Workflow.html">Mikrodatenanalyse</a>
</li>
<li>
  <a href="Links.html">Links</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Mikrodatenanalyse in R</h1>

</div>


<div id="ziele-der-sitzung" class="section level1">
<h1>Ziele der Sitzung</h1>
<ul>
<li>Setup eines effizienten Workflows für die Analyse von großen (Mikro-)Datensätzen</li>
<li>Mergen aus verschiedenen Datensätzen</li>
<li>Erstellen eines Arbeitsdatensatzes</li>
<li>Deskriptive Statistiken (numerisch und grafisch)</li>
<li>Gewichtete Statistiken</li>
</ul>
</div>
<div id="setup-eines-effizienten-workflows" class="section level1">
<h1>Setup eines effizienten Workflows</h1>
<div id="grundidee" class="section level2">
<h2>Grundidee</h2>
<ul>
<li>Mikrodatensätze wirken häufig komplex. Grund hierfür sind sicherlich die Dimensionen der Datensätze. Viele Beobachtungen (Zeilen!) treffen auf viele Variablen (Spalten!)</li>
<li>Bei der Datenanalyse unterscheiden sich die Workflows in der Grundstruktur kaum von der Analyse anderer <em>kleinerer</em> Datensätze:</li>
</ul>
<ol style="list-style-type: decimal">
<li>Daten einlesen</li>
<li>Daten säubern</li>
<li>Daten analysieren</li>
<li>Daten transformieren</li>
<li>Daten visualisieren</li>
<li>Daten kommunizieren</li>
</ol>
<p><img src="images/Workflow_Datenanalyse.png" /> Quelle: Vgl. <a href="https://bookdown.org/asmundhreinn/r4ds-master/wrangle-intro.html">R4DS</a></p>
<ul>
<li><p>In der Praxis geht es meist nicht so geradlinig zu. Insbesondere bei großen Datensätzen kann es sinnvol sein, einige Zwischenschritte einzubauen.</p></li>
<li><p>Bei der Arbeit mit Mikrodatensätzen müssen in der Regel verschiedene Datensätze zu einem Arbeitsdatensatz zusammengeführt werden.</p></li>
<li><p>Das Zusammenführen der Daten kann, je nach Größe der Datensätze einige Zeit in Anspruch nehmen. Um zu Vermeiden, den Arbeitsdatensatz ständig auf’s Neue zusammenzufügen, sollte ein Arbeitsdatensatz gespeichert werden.</p></li>
<li><p>An diesem sollten, außer dem Zusammenführen der Daten, noch keine Änderungen vergenommen worden sein. Das Verändern der Daten erfolgt erst in einem späteren Schritt. Geht im Verlaufe der Datenanalyse etwas schief und der Arbeitsdatensatz wird ausversehen überschrieben, kann schnell die Erstversion wiederhergestellt werden. Ein erneutes Zusammenstellen der Daten wird vermieden.</p></li>
<li><p>Ein effizienter Workflow bei der Analyse großer Datenmengen aus verschiedenen Quellen könnte also so aussehen:</p></li>
</ul>
<p><img src="images/Workflow_Datenanalyse_Mikrodaten.png" /> Quelle: Adaptiert von <a href="https://bookdown.org/asmundhreinn/r4ds-master/wrangle-intro.html">R4DS</a></p>
</div>
<div id="ordnerstruktur" class="section level2">
<h2>Ordnerstruktur</h2>
<ul>
<li>Ein effizienter Workflow beginnt bei einer effizienten Ordnerstruktur. Dabei sollte mir R-Projekten gearbeitet werden. Eine beispielhafte Ordnerstruktur könnte so aussehen:</li>
</ul>
<pre><code>## Beispielordner_Mikrodatenanalyse
## +-- 01_Daten.R
## +-- 02_Analyse.R
## +-- data_in
## |   +-- phealth.dta
## |   +-- pl.sav
## |   \-- ppathl.dta
## +-- data_out
## +-- graphs_out
## \-- Projekt_Mikrodatenanalyse.Rproj</code></pre>
<ul>
<li><p>Der Projektordner <tt> Beispielordner_Mikrodatenanalyse </tt> enthält alle relevanten Dateien. In der ersten Ebene liegt die .Rproj-Datei (<tt>Projekt_Mikrodatenanalyse.Rproj</tt>), .R-Dateien und Unterordner.</p></li>
<li><p>Ausgehend vom Projektordner, in dem die .Rproj-Datei liegt, können beliebige Unterordner gebildet werden. Alternativ zur obigen Struktur könnten die .R-Dateien auch in einen eigenen Ordner verschoben werden.</p></li>
<li><p>Andere Beispiele für Ordnerstrukturen finden sich zum Beispiel hier:</p></li>
</ul>
<blockquote>
<ul>
<li><a href="https://martinctc.github.io/blog/rstudio-projects-and-working-directories-a-beginner&#39;s-guide/">RStudio Projects and Working Directories: A Beginner’s Guide</a></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><a href="https://bookdown.org/lyzhang10/lzhang_r_tips_book/how-to-organize-a-project-folder.html">Bookdown: How to organize a project folder</a></li>
</ul>
</blockquote>
<blockquote>
<ul>
<li><a href="https://support.rstudio.com/hc/en-us/articles/200526207-Using-Projects">RStudio: Using Projects</a></li>
</ul>
</blockquote>
</div>
</div>
<div id="mikrodatenanalyse-praxisbeispiel" class="section level1">
<h1>Mikrodatenanalyse Praxisbeispiel</h1>
<div id="daten-einlesen" class="section level2">
<h2>Daten einlesen</h2>
<div id="problem" class="section level3">
<h3>Problem:</h3>
<p>Mikrodaten werden in der Regel (noch) nicht in einem R-Datenformat ausgeliefert. Häufig sind zunächst nur dta-Dateien (Stata) oder sav-Dateien (SPSS) verfügbar.</p>
<p>###Lösung:</p>
<p>Das Paket <tt>haven</tt> ermöglicht das Einlesen <em>fremder</em> Dateitypen.</p>
<pre class="r"><code>#Einmalig installieren
install.packages(&quot;haven&quot;)</code></pre>
<pre class="r"><code>#Laden
library(haven)</code></pre>
<ul>
<li>Das Paket bietet verschiedene Funktionen, um fremde Dateiformate einzulesen, und diese zu speichern. Stata oder SPSS-Nutzer sind zudem die Arbeit mit <em>Labeln</em> gewohnt. In R wird dies standardmäßig nicht unterstützt. <tt>haven</tt> enthält verschiedene Funktionen, um Label zu definieren, ändern, löschen, usw.:</li>
</ul>
<pre class="r"><code>#Liste aller Funktionen im Paket haven
ls(&quot;package:haven&quot;)</code></pre>
<pre><code>##  [1] &quot;as_factor&quot;                &quot;format_tagged_na&quot;        
##  [3] &quot;is.labelled&quot;              &quot;is_tagged_na&quot;            
##  [5] &quot;labelled&quot;                 &quot;labelled_spss&quot;           
##  [7] &quot;na_tag&quot;                   &quot;print_labels&quot;            
##  [9] &quot;print_tagged_na&quot;          &quot;read_dta&quot;                
## [11] &quot;read_por&quot;                 &quot;read_sas&quot;                
## [13] &quot;read_sav&quot;                 &quot;read_spss&quot;               
## [15] &quot;read_stata&quot;               &quot;read_xpt&quot;                
## [17] &quot;tagged_na&quot;                &quot;vec_arith.haven_labelled&quot;
## [19] &quot;write_dta&quot;                &quot;write_sas&quot;               
## [21] &quot;write_sav&quot;                &quot;write_xpt&quot;               
## [23] &quot;zap_empty&quot;                &quot;zap_formats&quot;             
## [25] &quot;zap_label&quot;                &quot;zap_labels&quot;              
## [27] &quot;zap_missing&quot;              &quot;zap_widths&quot;</code></pre>
<p>Für unsere Mikrodatenanalyse nutzen wir drei Datensätze: <tt>ppathl.dta</tt>, <tt>pl.sav</tt>, <tt>phealth.dta</tt>. Wir lesen diese mit den Befehlen</p>
<pre class="r"><code>ppathl &lt;- read_dta(&quot;Beispielordner_Mikrodatenanalyse/data_in/ppathl.dta&quot;)
pl &lt;- read_sav(&quot;Beispielordner_Mikrodatenanalyse/data_in/pl.sav&quot;)
phealth &lt;- read_dta(&quot;Beispielordner_Mikrodatenanalyse/data_in/phealth.dta&quot;)

ppathl</code></pre>
<pre><code>## # A tibble: 12,922 x 4
##    persnr  jahr          sex weight
##     &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl+lbl&gt;  &lt;dbl&gt;
##  1 500575  2001 1 [weiblich]   467.
##  2 279067  2003 1 [weiblich]   860.
##  3 238927  2004 0 [maenlich]   343.
##  4 240595  2004 0 [maenlich]   869.
##  5  88977  2003 1 [weiblich]   367.
##  6 254006  2001 0 [maenlich]   314.
##  7 344281  2003 1 [weiblich]   892.
##  8 666151  2002 0 [maenlich]   908.
##  9 383792  2001 0 [maenlich]   793.
## 10 482355  2002 1 [weiblich]   648.
## # ... with 12,912 more rows</code></pre>
<pre class="r"><code>pl</code></pre>
<pre><code>## # A tibble: 12,922 x 6
##    persnr  jahr bildung anz_kind  bula region
##     &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; 
##  1 294354  2001    10.5        0    11 Land  
##  2 414129  2001    12          0     4 Stadt 
##  3 417490  2002    10.5        2     2 Land  
##  4 334726  2000     9          0    14 Stadt 
##  5 569347  2001    11          2    15 Stadt 
##  6 471291  2003    18          0    11 Land  
##  7 663550  2004    11          0    15 Stadt 
##  8 587268  2001    NA          0     6 Stadt 
##  9  75033  2000    13          1    13 Stadt 
## 10 180832  2003    12          0    13 Land  
## # ... with 12,912 more rows</code></pre>
<pre class="r"><code>phealth</code></pre>
<pre><code>## # A tibble: 12,276 x 6
##    persnr  jahr      gesund_org gesund_std               lebensz_org lebensz_std
##     &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl+lbl&gt;      &lt;dbl&gt;                 &lt;dbl+lbl&gt;       &lt;dbl&gt;
##  1 235585  2000 4 [Gut]              0.567  5 [5 Zufrieden: Skala 0~     -1.23  
##  2  74141  2000 3 [Zufriedenst~     -0.464  6 [6 Zufrieden: Skala 0~     -0.659 
##  3 512655  2001 4 [Gut]              0.567  6 [6 Zufrieden: Skala 0~     -0.659 
##  4 259440  2003 3 [Zufriedenst~     -0.464  8 [8 Zufrieden: Skala 0~      0.477 
##  5 527534  2002 4 [Gut]              0.567  9 [9 Zufrieden: Skala 0~      1.05  
##  6 510444  2001 1 [Schlecht]        -2.53   5 [5 Zufrieden: Skala 0~     -1.23  
##  7 396886  2001 2 [Weniger_gut]     -1.49   6 [6 Zufrieden: Skala 0~     -0.659 
##  8 246747  2002 5 [Sehr_gut]         1.60  10 [10 Zufrieden: Skala ~      1.61  
##  9 544752  2001 4 [Gut]              0.567  6 [6 Zufrieden: Skala 0~     -0.659 
## 10 152915  2000 5 [Sehr_gut]         1.60   7 [7 Zufrieden: Skala 0~     -0.0909
## # ... with 12,266 more rows</code></pre>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
