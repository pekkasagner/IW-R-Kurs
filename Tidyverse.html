<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Das Tidyverse</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 45px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h2 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h3 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h4 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h5 {
  padding-top: 50px;
  margin-top: -50px;
}
.section h6 {
  padding-top: 50px;
  margin-top: -50px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">IW-R-Kurs</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="Zeitplan.html">Zeitplan</a>
</li>
<li>
  <a href="Before_We_get_Started.html">Vorab</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Kursinhalte
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="Einführung.html">Einführung</a>
    </li>
    <li>
      <a href="Tidyverse.html">Tidyverse</a>
    </li>
    <li>
      <a href="ggplot.html">ggplot2</a>
    </li>
    <li>
      <a href="Mikrodatenanalyse_Workflow.html">Mikrodatenanalyse</a>
    </li>
    <li>
      <a href="Karten.html">Karten und Geodaten</a>
    </li>
    <li>
      <a href="Animationen.html">Animationen</a>
    </li>
    <li>
      <a href="Interaktive_Abbildungen.html">Interaktive Abbildungen</a>
    </li>
  </ul>
</li>
<li>
  <a href="Codebeispiele.html">Beispiele</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Das Tidyverse</h1>

</div>


<hr />
<div id="ziele-der-sitzung" class="section level1">
<h1>Ziele der Sitzung</h1>
<ul>
<li>Grundverständnis der tidyverse</li>
<li>Laden verschiedener Dateiformate</li>
<li>Bearbeiten von Daten</li>
<li>Verstädnnigs von Pipes (%&gt;%)</li>
<li>Übergang in ggplot2</li>
</ul>
<hr />
</div>
<div id="was-ist-das-tidyverse" class="section level1">
<h1>Was ist das tidyverse?</h1>
<p>Das <a href="https://www.tidyverse.org/">tidyverse</a> in R ist eine Sammlung von Paketen, denen dieselbe Repräsentation von Daten (<a href="https://vita.had.co.nz/papers/tidy-data.pdf">tidy data</a>) zu Grunde liegen und die ein gemeinsames API Design nutzen. “Tidy data” umschreibt “aufgeräumte” bzw. “saubere” Daten und damit Daten, die so aufbereitet sind, dass jede Variable in einer Spalte und jede Beobachtung in einer Reihe repäsentiert wird. Die Pakete und Funktionen des tidyverse können die oft sperrigen und schwer verständlichen Base-R Funktionen fast vollständig ersetzen und bieten einen intuitiven Einstieg in die Analyse und Visualisierung von Daten.</p>
<hr />
</div>
<div id="installation-und-inhalt" class="section level1">
<h1>Installation und Inhalt</h1>
<p>Das tidyverse kann über den Befehl <code>install.packages(“tidyverse”)</code> installiert werden. Wird die Bibilothek in mit <code>library(tidyverse) </code> in die Umgebung geladen, sind die folgenden Pakete direkt nutzbar:</p>
<ul>
<li><a href="https://ggplot2.tidyverse.org">ggplot2</a>, für Datenvisualisierung,</li>
<li><a href="https://dplyr.tidyverse.org">dplyr</a>, für Datenbearbeitung,</li>
<li><a href="https://tidyr.tidyverse.org">tidyr</a>, für das Säubern von Daten,</li>
<li><a href="https://readr.tidyverse.org">readr</a>, für den Import von Daten,</li>
<li><a href="https://purrr.tidyverse.org">purrr</a>, für funktionales Programmieren,</li>
<li><a href="https://tibble.tidyverse.org">tibble</a>, für Tibbles (eine Art DataFrame),</li>
<li><a href="https://github.com/tidyverse/stringr">stringr</a>, für Strings,</li>
<li><a href="https://github.com/hadley/forcats">forcats</a>, für Faktor-Variablen.</li>
</ul>
<p>Neben den bisher genannten Paketen, die sofort genutzt werden können, wenn das tidyverse-Paket geladen wird, installiert der Befehl <code>install.packages(“tidyverse”)</code> weitere Pakete. Diese werden seltener gebraucht, sind aber doch so gebräuchlich, dass sie direkt mit installiert werden. Über den <code>library(“Paketname”)</code> Befehl müssen diese allerdings je nach Anwendungsbedarf zusätzlich in die Arbeitsumgebung geladen werden. Diese mit installierten Befehle umfassen:</p>
<ul>
<li><p>Für die Arbeit mit Daten mit zeitlichem Bezug:</p>
<ul>
<li><a href="https://github.com/rstats-db/hms">hms</a>, für Uhrzeiten,</li>
<li><a href="https://github.com/tidyverse/lubridate">lubridate</a>, für Datums/Zeit-Transformationen.</li>
</ul></li>
<li><p>Für den Import weiterer Datenformate:</p>
<ul>
<li><a href="https://github.com/wesm/feather">feather</a>, für das Teilen von Daten mit Python und weiteren Programmiersprachen,</li>
<li><a href="https://github.com/tidyverse/haven">haven</a>, für SPSS, SAS and <strong>Stata</strong> Daten</li>
<li><a href="https://github.com/r-lib/httr">httr</a>, für Web-APIs,</li>
<li><a href="https://github.com/jeroen/jsonlite">jsonlite</a> für JSON,</li>
<li><a href="https://github.com/tidyverse/readxl">readxl</a>, für <code>.xls</code> und <code>.xlsx</code> Dateien,</li>
<li><a href="https://github.com/tidyverse/rvest">rvest</a>, für Web-Scraping,</li>
<li><a href="https://github.com/r-lib/xml2">xml2</a>, für XML</li>
</ul></li>
<li><p>Modellierung</p>
<ul>
<li><a href="https://github.com/tidymodels/broom">broom</a>, für das Säubern / Auslesen von Modellobjekten.</li>
</ul></li>
</ul>
<hr />
<div id="mögliche-probleme" class="section level2">
<h2>Mögliche Probleme</h2>
<p>Lädt man das tidyverse in die Arbeitsumgebung, wird folgende Nachricht angezeigt:</p>
<center>
<p><img src="images/tidyverse_1_load.png" style="width:75.0%" /></p>
</center>
<p>Einerseits werden hier unter “Attaching packages” die geladenen Pakete samt der jeweiligen Version angezeigt. Unter “Conflicts” gibt es zudem zwei Warnhinweise. Diese weisen auf mögliche Probleme bei der Nutzung verschiedener R-Pakete hin. Hier werden durch das Laden des tidyverse zwei Befehle aus der “stats-Bibliothek” maskiert, also überschrieben. Konkret bedeutet das, dass nachdem das tidyverse geladen wurde, die Befehle <code>filter()</code> und <code>lag()</code> ihre Funktionalität aus dem “dplyr-Paket” und nicht mehr von “stats” beziehen. Möchte man jetzt die <code>filter()</code> Funktion aus der stats-Bibliothek nutzen, kann man diesen folgendermaßen aufrufen <code>stats::filter()</code>.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="co"># Lädt nur die filter() Funktion von dplyr</span></span>
<span id="cb1-2"><a href="#cb1-2"></a>dplyr<span class="op">::</span><span class="kw">filter</span>()</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="co"># Lädt alle (!) Funktionen von dplyr und nutzt dann filter()</span></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(dplyr)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">filter</span>()</span></code></pre></div>
<hr />
</div>
</div>
<div id="datenmanagement-im-tidyverse" class="section level1">
<h1>Datenmanagement im tidyverse</h1>
<p>Das tidyverse bietet ein kohärentes Framework, in welchem Daten intuitiv in ein gewünschtes Format übertragen werden können. Zunächst wird das Konzept von “Tidy Data” erklärt und anschließen ein Beispieldatensatz von Arbeitslosenzaheln in deutschen Landkreisen geladen.</p>
<hr />
<div id="tidy-data" class="section level2">
<h2>Tidy Data</h2>
<p>“Tidy data” umschreibt “aufgeräumte” bzw. “saubere” Daten und damit Daten, die so aufbereitet sind, dass jede Variable in einer Spalte und jede Beobachtung in einer Reihe repäsentiert wird. Es ist wichtig, das Konuzept von tidy data zu verstehen, da alle Pakete im tidyverse darauf basieren. Im tidy data Format sollte ein Datensatz von den folgenden, zusammenhängenden Regeln beschrieben werden können:</p>
<ol style="list-style-type: decimal">
<li>Jede Variable muss in einer eigenen Spalte sein</li>
<li>Jede Beobachtung muss eine eigene Zeile haben</li>
<li>Jeder Wert muss eine eigene Zelle haben</li>
</ol>
<p>Im folgenden Kapitel werden diese Regeln anhand eines Beispiels verdeutlicht.</p>
<hr />
</div>
<div id="laden-der-daten" class="section level2">
<h2>Laden der Daten</h2>
<p>In ihrer ursprünglichen Form sehen die Daten folgendermaßen aus:</p>
<center>
<p><img src="images/tidyverse_3_data_horrible_data.png" style="width:100.0%" /></p>
</center>
<p>Hier sieht man, dass sich die obene genannten Regeln für tidy data nicht anwenden lassen. Während die Variablen “Kennziffer”, “Raumeinheit” und “Aggregat” korrekt in einer Spalte gespeichert wurden, wurden die Variablen “Arbeitslosenquote” und “Jahr” auf mehrere Spalten (ins wide format) aufgeteilt. Dadurch hat jede Beobachtung (also die Arbeitslosenquote einer Raumeinheit pro Jahr) auch nicht eine eigene Zeile. Der folgende R-Code lädt die Daten und überführt sie in ein tidy data Format.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb2-2"><a href="#cb2-2"></a></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co"># Laden der Daten</span></span>
<span id="cb2-4"><a href="#cb2-4"></a>Arbeitslosenquote &lt;-<span class="st"> </span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="st">  </span>readxl<span class="op">::</span><span class="kw">read_xls</span>(<span class="st">&#39;daten_beispiele/Arbeitslosenquote.xls&#39;</span>,</span>
<span id="cb2-6"><a href="#cb2-6"></a>                         <span class="dt">skip =</span> <span class="dv">1</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="st">  </span><span class="kw">rename</span>(<span class="st">&#39;Kennziffer&#39;</span> =<span class="st"> &#39;...1&#39;</span>,</span>
<span id="cb2-8"><a href="#cb2-8"></a>         <span class="st">&#39;Raumeinheit&#39;</span> =<span class="st"> &#39;...2&#39;</span>,</span>
<span id="cb2-9"><a href="#cb2-9"></a>         <span class="st">&#39;Aggregat&#39;</span> =<span class="st"> &#39;...3&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="op">!</span><span class="kw">c</span>(Kennziffer, Raumeinheit, Aggregat), </span>
<span id="cb2-11"><a href="#cb2-11"></a>               <span class="dt">names_to =</span> <span class="st">&#39;Jahr&#39;</span>, </span>
<span id="cb2-12"><a href="#cb2-12"></a>               <span class="dt">values_to =</span> <span class="st">&#39;Arbeitslosenquote&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Jahr =</span> <span class="kw">as.integer</span>(Jahr)) </span></code></pre></div>
<p>Hier wird zunächst mit <code>read_xls()</code> die .xls-Datei geladen. Da das Paket readxl zwar im tidyverse mit heruntergeladen aber nicht automatisch in die Arbeitsumgebung geladen wird, wird das Paket hier mit <code>readxl::read_xls()</code> direkt angesprochen. Der Zusatz <code>skip = 1</code> überspringt die erste Zeile der .xls-Datei, da die Variabelnnamen auf zwei Spalten verteilt sind.</p>
<p>Mit der Funktion <code>rename()</code> werden die fehlenden Variablennamen ergänzt.</p>
<p>Die letzte Funktion <code>pivot_longer()</code> überführt die restlichen Spalten vom wide ins long Format. Die Funktion wird im späteren Kursverlauf genauer erklärt.</p>
<p>Zuletzt wird die Variable “Jahr” in die <code>integer</code> Klasse überführt.</p>
<p>Der daraus resultierende Datensatz kann mit <code>View(Arbeitslosenquote)</code> im Viewer von R-Studio betrachtet werden.</p>
<center>
<p><img src="images/tidyverse_2_data_clean.png" style="width:80.0%" /></p>
</center>
<hr />
</div>
<div id="magrittr-pipe" class="section level2">
<h2>magrittr-Pipe (%&gt;%)</h2>
<p>Das tidyverse lädt automatisch die sogenannte “Pipe” aus dem magrittr-Paket. Die Pipe erlaubt es, Code zu schreiben der einfacher verstehen und zu lesen ist. Wollen wir etwa die fünf kreisfreien Städte mit der höchsten Arbeitslosenquote im aktuellsten Jahr gibt es mehrere Möglichkeiten, diese darzustellen. Eine Möglichkeit wäre, die notwendigen Operationen in neue Objekte zu speichern und diese dann weiterzu bearbeiten.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>Arbeitslosenquote_<span class="dv">1</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(Arbeitslosenquote, Aggregat <span class="op">==</span><span class="st"> &quot;krsfr. Stadt&quot;</span>)</span>
<span id="cb3-2"><a href="#cb3-2"></a>Arbeitslosenquote_<span class="dv">2</span> &lt;-<span class="st"> </span><span class="kw">filter</span>(Arbeitslosenquote_<span class="dv">1</span>, Jahr <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(Jahr))</span>
<span id="cb3-3"><a href="#cb3-3"></a>Arbeitslosenquote_<span class="dv">3</span> &lt;-<span class="st"> </span><span class="kw">top_n</span>(Arbeitslosenquote_<span class="dv">2</span>, <span class="dv">5</span>)</span>
<span id="cb3-4"><a href="#cb3-4"></a>Arbeitslosenquote_<span class="dv">4</span> &lt;-<span class="st"> </span><span class="kw">arrange</span>(Arbeitslosenquote_<span class="dv">3</span>, <span class="kw">desc</span>(Arbeitslosenquote))</span>
<span id="cb3-5"><a href="#cb3-5"></a>Arbeitslosenquote_<span class="dv">4</span></span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   Kennziffer Raumeinheit          Aggregat     Jahr  Arbeitslosenquote
##   &lt;chr&gt;      &lt;chr&gt;                &lt;chr&gt;        &lt;chr&gt;             &lt;dbl&gt;
## 1 05513      Gelsenkirchen, Stadt krsfr. Stadt 2017               14  
## 2 04012      Bremerhaven, Stadt   krsfr. Stadt 2017               13  
## 3 05112      Duisburg, Stadt      krsfr. Stadt 2017               12.5
## 4 07317      Pirmasens, Stadt     krsfr. Stadt 2017               12.3
## 5 05916      Herne, Stadt         krsfr. Stadt 2017               12.1</code></pre>
<p>Mit der Pipe lässt sich der obige Code wie folgt darstellen.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>Arbeitslosenquote <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="st">  </span><span class="kw">filter</span>(Aggregat <span class="op">==</span><span class="st"> &quot;krsfr. Stadt&quot;</span>,</span>
<span id="cb5-3"><a href="#cb5-3"></a>         Jahr <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(Jahr)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="st">  </span><span class="kw">top_n</span>(<span class="dv">5</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(Arbeitslosenquote))</span></code></pre></div>
<pre><code>## # A tibble: 5 x 5
##   Kennziffer Raumeinheit          Aggregat     Jahr  Arbeitslosenquote
##   &lt;chr&gt;      &lt;chr&gt;                &lt;chr&gt;        &lt;chr&gt;             &lt;dbl&gt;
## 1 05513      Gelsenkirchen, Stadt krsfr. Stadt 2017               14  
## 2 04012      Bremerhaven, Stadt   krsfr. Stadt 2017               13  
## 3 05112      Duisburg, Stadt      krsfr. Stadt 2017               12.5
## 4 07317      Pirmasens, Stadt     krsfr. Stadt 2017               12.3
## 5 05916      Herne, Stadt         krsfr. Stadt 2017               12.1</code></pre>
<p>Vor allem in punkto Lesbarkeit und Kompaktheit bietet die Pipe gegenüber ihren Alternativen große Vorteile. Auch wird hier kein zusätzlicher Arbeitsspeicher verwendent, um Objekte zu speichern, die eigentlich gar nicht benötigt werden. Illustriert am obigen Beispiel, kann man die Pipe folgendermaßen verstehen:</p>
<ol style="list-style-type: decimal">
<li><p>Das aktuelle Datenobjekt wird immer in den nächsten Schritt weitergegeben. Hier wird das Objekt “Arbeitslosenquote” also direkt im auf <code>%&gt;%</code> folgenden Befehl als Datenobjekt verwendet. So entfällt der Schritt, in jeder Funktion vom Format <code>filter(data, variable == “value”)</code>, das Datenobjekt (data) mit anzugeben.</p></li>
<li><p>Das bearbeitete Objekt wird immer in den nächsten Schritt weitergegeben, ohne dass es zwischengespeichert wird und werden muss.</p></li>
</ol>
<p>Vereinfacht gesagt ist also</p>
<ul>
<li><code>x %&gt;% f</code> äquivalent zu <code>f(x)</code></li>
<li><code>x %&gt;% f(y)</code> äquaivalent zu <code>f(x , y)</code> und</li>
<li><code>x %&gt;% f %&gt;% g %&gt;% h</code> äquivalent zu <code>h(g(f(x)))</code></li>
</ul>
<p>Vor allem in der explorativen Datenanalyse und beim Erstellen von Visualisierungen ist die Pipe sehr gut geeignet. Bei sehr komplizierten Datenstrukturen, oder sehr vielen Operationen sollte man allerdings auf andere Tools zurückgreifen.</p>
<hr />
</div>
<div id="dplyrfilter" class="section level2">
<h2>dplyr::filter()</h2>
<p>Die <code>filter()</code> Funktion ermöglicht, wie der Name impliziert, das filtern von Datensätzen nach festgelegten Kriterien.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Filtern nach Aggregat und Arbeitslosenquote</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>Arbeitslosenquote <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span><span class="kw">filter</span>(Aggregat <span class="op">==</span><span class="st"> &quot;Landkreis&quot;</span>,</span>
<span id="cb7-4"><a href="#cb7-4"></a>         Arbeitslosenquote <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1,148 x 5
##    Kennziffer Raumeinheit         Aggregat  Jahr  Arbeitslosenquote
##    &lt;chr&gt;      &lt;chr&gt;               &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;
##  1 01051      Dithmarschen        Landkreis 1998               10.7
##  2 01051      Dithmarschen        Landkreis 2003               10.5
##  3 01051      Dithmarschen        Landkreis 2004               11.1
##  4 01051      Dithmarschen        Landkreis 2005               13.7
##  5 01051      Dithmarschen        Landkreis 2006               11.8
##  6 01054      Nordfriesland       Landkreis 2005               10.1
##  7 01055      Ostholstein         Landkreis 1998               10.2
##  8 01055      Ostholstein         Landkreis 2005               11.3
##  9 01056      Pinneberg           Landkreis 2005               10.1
## 10 01059      Schleswig-Flensburg Landkreis 2005               10.2
## # ... with 1,138 more rows</code></pre>
<hr />
</div>
<div id="dplyrselect" class="section level2">
<h2>dplyr::select()</h2>
<p>Mit der Funktion <code>select()</code> wählt man alle relevanten Spalten bzw. Variablen aus einem Datensatz aus.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a>Arbeitslosenquote <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="st">  </span><span class="kw">select</span>(Raumeinheit, Jahr, Arbeitslosenquote)</span></code></pre></div>
<pre><code>## # A tibble: 8,020 x 3
##    Raumeinheit      Jahr  Arbeitslosenquote
##    &lt;chr&gt;            &lt;chr&gt;             &lt;dbl&gt;
##  1 Flensburg, Stadt 1998               14.6
##  2 Flensburg, Stadt 1999               13  
##  3 Flensburg, Stadt 2000               11.8
##  4 Flensburg, Stadt 2001               12.1
##  5 Flensburg, Stadt 2002               12.1
##  6 Flensburg, Stadt 2003               13.7
##  7 Flensburg, Stadt 2004               14  
##  8 Flensburg, Stadt 2005               18.3
##  9 Flensburg, Stadt 2006               15.4
## 10 Flensburg, Stadt 2007               12.5
## # ... with 8,010 more rows</code></pre>
<hr />
</div>
<div id="dplyrmutate" class="section level2">
<h2>dplyr::mutate()</h2>
<p>Die Funktion <code>mutate()</code> erlaubt es, Spalten bzw. Variablen in einem Datensatz zu verändern oder neue Spalten zu erzeugen.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>Arbeitslosenquote <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-2"><a href="#cb11-2"></a><span class="st">  </span><span class="kw">select</span>(Raumeinheit, Jahr, Arbeitslosenquote) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-3"><a href="#cb11-3"></a><span class="st">  </span><span class="kw">filter</span>(Jahr <span class="op">==</span><span class="st"> &quot;2007&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb11-4"><a href="#cb11-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Abweichung =</span> Arbeitslosenquote <span class="op">-</span><span class="st"> </span><span class="kw">mean</span>(Arbeitslosenquote))</span></code></pre></div>
<pre><code>## # A tibble: 401 x 4
##    Raumeinheit         Jahr  Arbeitslosenquote Abweichung
##    &lt;chr&gt;               &lt;chr&gt;             &lt;dbl&gt;      &lt;dbl&gt;
##  1 Flensburg, Stadt    2007               12.5      3.86 
##  2 Kiel, Stadt         2007               12.6      3.96 
##  3 Lübeck, Stadt       2007               13.1      4.46 
##  4 Neumünster, Stadt   2007               11.6      2.96 
##  5 Dithmarschen        2007               10        1.36 
##  6 Herzogtum Lauenburg 2007                7.2     -1.44 
##  7 Nordfriesland       2007                8.5     -0.141
##  8 Ostholstein         2007                8.8      0.159
##  9 Pinneberg           2007                6.8     -1.84 
## 10 Plön                2007                7.6     -1.04 
## # ... with 391 more rows</code></pre>
<hr />
</div>
<div id="dplyrgroup_by" class="section level2">
<h2>dplyr::group_by()</h2>
<p><code>group_by()</code> gruppiert bestimmte Variablen in gewünschte Gruppen für nachfolgende Operationen. Viele Funktionen bauen auf <code>group_by</code> auf.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>Arbeitslosenquote <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-2"><a href="#cb13-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Kennziffer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-3"><a href="#cb13-3"></a><span class="st">  </span><span class="kw">filter</span>(Jahr <span class="op">==</span><span class="st"> &quot;1998&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-4"><a href="#cb13-4"></a><span class="st">  </span><span class="kw">group_by</span>(Aggregat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-5"><a href="#cb13-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Quote_Aggr =</span> <span class="kw">mean</span>(Arbeitslosenquote)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb13-6"><a href="#cb13-6"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 401 x 5
##    Raumeinheit         Aggregat      Jahr Arbeitslosenquote Quote_Aggr
##    &lt;chr&gt;               &lt;chr&gt;        &lt;int&gt;             &lt;dbl&gt;      &lt;dbl&gt;
##  1 Flensburg, Stadt    krsfr. Stadt  1998              14.6       12.4
##  2 Kiel, Stadt         krsfr. Stadt  1998              13.9       12.4
##  3 Lübeck, Stadt       krsfr. Stadt  1998              13.4       12.4
##  4 Neumünster, Stadt   krsfr. Stadt  1998              13.4       12.4
##  5 Dithmarschen        Landkreis     1998              10.7       10.1
##  6 Herzogtum Lauenburg Landkreis     1998               8.3       10.1
##  7 Nordfriesland       Landkreis     1998               9.2       10.1
##  8 Ostholstein         Landkreis     1998              10.2       10.1
##  9 Pinneberg           Landkreis     1998               8.4       10.1
## 10 Plön                Landkreis     1998               8.9       10.1
## # ... with 391 more rows</code></pre>
<hr />
</div>
<div id="summarise" class="section level2">
<h2>summarise()</h2>
<p><code>summarise()</code> oder <code>summarize()</code> fasst alle Reihen zusammen und gibt eine Zusammenfassung dieser Reihen aus.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>Arbeitslosenquote <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Kennziffer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-3"><a href="#cb15-3"></a><span class="st">  </span><span class="kw">filter</span>(Jahr <span class="op">==</span><span class="st"> &quot;1998&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-4"><a href="#cb15-4"></a><span class="st">  </span><span class="kw">group_by</span>(Aggregat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-5"><a href="#cb15-5"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Quote_Aggr =</span> <span class="kw">mean</span>(Arbeitslosenquote)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb15-6"><a href="#cb15-6"></a><span class="st">  </span><span class="kw">ungroup</span>()</span></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   Aggregat     Quote_Aggr
##   &lt;chr&gt;             &lt;dbl&gt;
## 1 krsfr. Stadt       12.4
## 2 Landkreis          10.1</code></pre>
<hr />
</div>
<div id="arrange" class="section level2">
<h2>arrange()</h2>
<p>Die Funktion <code>arrange()</code> sortiert die Daten in einer gewünschten Reihenfolge.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>Arbeitslosenquote <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-2"><a href="#cb17-2"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>Kennziffer) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-3"><a href="#cb17-3"></a><span class="st">  </span><span class="kw">filter</span>(Jahr <span class="op">==</span><span class="st"> </span><span class="kw">max</span>(Jahr)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb17-4"><a href="#cb17-4"></a><span class="st">  </span><span class="kw">arrange</span>(Arbeitslosenquote)</span></code></pre></div>
<pre><code>## # A tibble: 401 x 4
##    Raumeinheit          Aggregat  Jahr  Arbeitslosenquote
##    &lt;chr&gt;                &lt;chr&gt;     &lt;chr&gt;             &lt;dbl&gt;
##  1 Eichstätt            Landkreis 2017                1.5
##  2 Erding               Landkreis 2017                1.8
##  3 Pfaffenhofen a.d.Ilm Landkreis 2017                1.8
##  4 Neumarkt i.d.OPf.    Landkreis 2017                1.9
##  5 Regensburg           Landkreis 2017                1.9
##  6 Unterallgäu          Landkreis 2017                1.9
##  7 Donau-Ries           Landkreis 2017                1.9
##  8 Ebersberg            Landkreis 2017                2  
##  9 Erlangen-Höchstadt   Landkreis 2017                2  
## 10 Main-Spessart        Landkreis 2017                2  
## # ... with 391 more rows</code></pre>
<hr />
</div>
</div>
<div id="übergang-in-ggplot2" class="section level1">
<h1>Übergang in ggplot2</h1>
<p>Für das Erstellen von Grafiken mit ggplot2 müssen die Daten im oben beschriebenen tidy data Format sein. Ein guter Workflow beinhaltet deshalb, die Daten mit den oben besprochenen Funktionen in das gewünschte Format zu bringen und dann direkt mit der Pipe nach ggplot zu übergeben.</p>
<p>Eine beispielhafte erste Grafik, die die Arbeitslosenquote pro Jahr und Aggregat zeigt, könnte folgendermaßen aussehen:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a>Arbeitslosenquote <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="st">  </span><span class="kw">group_by</span>(Aggregat, Jahr) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-3"><a href="#cb19-3"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">Arbeitslosenquote =</span> <span class="kw">mean</span>(Arbeitslosenquote)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb19-4"><a href="#cb19-4"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> Jahr, </span>
<span id="cb19-5"><a href="#cb19-5"></a>             <span class="dt">y =</span> Arbeitslosenquote, </span>
<span id="cb19-6"><a href="#cb19-6"></a>             <span class="dt">group =</span> Aggregat, </span>
<span id="cb19-7"><a href="#cb19-7"></a>             <span class="dt">col =</span> Aggregat)) <span class="op">+</span></span>
<span id="cb19-8"><a href="#cb19-8"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">size =</span> <span class="fl">1.0</span>) <span class="op">+</span></span>
<span id="cb19-9"><a href="#cb19-9"></a><span class="st">  </span><span class="kw">theme_minimal</span>()</span></code></pre></div>
<p><img src="Tidyverse_files/figure-html/plot_1-1.png" width="672" /></p>
<p>Ausführliche Informationen zu Datenvisualisierung in R mit ggplot2 gibt es im anschließenden Kapitel unter “Visualisierung”.</p>
<hr />
</div>
<div id="weiterführende-informationen" class="section level1">
<h1>Weiterführende Informationen</h1>
<p>Hier werden eine Reihe von Links mit weiterführenden Informationen zum Datenmanagement mit dem Tidyverse angeführt. Auch wenn dieser Kurs hauptsächlich Datenvisualisierung diskutiert, ist das Datenmanagement und die Transformation von Daten ein zentraler Teil von Datenvisualisierung. Deshalb ist es unerlässlich, sich vertieft mit den wichtigsten dplyr-Funktionen vertraut zu machen und diese regelmäßig zu benutzen. Gute weiterführende Informationsquellen über das Datenmanagement im Tidyverse sind deshalb hier aufgeführt.</p>
<ul>
<li><p><a href="https://r4ds.had.co.nz/wrangle-intro.html">R for Data Science (Kapitel 9-21)</a></p></li>
<li><p><a href="https://bookdown.org/yih_huynh/Guide-to-R-Book/basic-data-management.html">Yih Huynh - Guide to R (Kapitel 6 und 7)</a></p></li>
<li><p><a href="https://dplyr.tidyverse.org/">dplyr Beschreibung</a></p></li>
</ul>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
